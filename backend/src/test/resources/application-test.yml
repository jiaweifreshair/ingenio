# Ingenio Backend - E2E测试配置
spring:
  application:
    name: ingenio-backend-test

  # 数据源配置（由TestContainers动态提供）
  datasource:
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2

  # Redis配置（由TestContainers动态提供）
  redis:
    timeout: 3000ms

  # Jackson配置
  jackson:
    default-property-inclusion: non_null
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss

  # Spring AI OpenAI配置（测试环境使用真实AI服务）
  # 通过环境变量注入真实的API密钥，确保测试环境与生产环境AI行为一致
  ai:
    openai:
      # 从环境变量读取API密钥（支持多个环境变量名称）
      api-key: ${SPRING_AI_OPENAI_API_KEY:${QINIU_CLOUD_API_KEY:${QINIU_AI_API_KEY:${DEEPSEEK_API_KEY:sk-test-placeholder}}}}
      # 使用七牛云OpenAI兼容接口
      base-url: ${SPRING_AI_OPENAI_BASE_URL:${QINIU_CLOUD_BASE_URL:https://api.qnaigc.com}}
      chat:
        enabled: true
        options:
          # 使用通义千问模型（七牛云提供）
          model: qwen3-235b-a22b-instruct-2507
          temperature: 0.3
          max-tokens: 4096
          timeout: 30s  # 测试环境适当缩短超时时间
    # DashScope配置（备用）
    dashscope:
      api-key: ${DASHSCOPE_API_KEY:sk-placeholder}
      base-url: https://dashscope.aliyuncs.com
      chat:
        enabled: false
        options:
          model: qwen-max
          temperature: 0.3
          max-tokens: 4096
          timeout: 90s
          max-retries: 2

  # 禁用不需要的自动配置（测试环境）
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration
      # 注意：不排除OpenAI自动配置，否则ChatModel bean无法创建
      # 通过配置enabled: false和mock的api-key来禁用实际调用

# MyBatis-Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
  global-config:
    db-config:
      id-type: auto

# SaToken配置（测试环境简化配置）
sa-token:
  token-name: Authorization
  timeout: 3600
  is-concurrent: true
  is-share: false
  token-style: jwt
  is-log: false
  jwt-secret-key: test-jwt-secret-key

# 服务器配置
server:
  port: 0  # 随机端口
  servlet:
    context-path: /api

# 日志配置（测试环境减少日志输出）
logging:
  level:
    root: WARN
    com.ingenio.backend: INFO
    com.baomidou.mybatisplus: WARN
    org.springframework.ai: WARN

# 应用自定义配置
ingenio:
  # 租户配置
  tenant:
    enabled: true
    default-tenant-id: 00000000-0000-0000-0000-000000000002

  # AI配置（测试环境）
  ai:
    # UniAix配置（测试环境使用占位符）
    uniaix:
      base-url: https://api.uniaix.com
      api-key: sk-test-placeholder
      default-model: claude-3-5-sonnet-20241022
      timeout: 180000

# 微信配置（测试环境使用占位符）
wechat:
  appid: test-appid
  secret: test-secret
  redirect-uri: http://localhost:3000/auth/callback

# 邮件配置（测试环境Mock）
spring.mail:
  host: localhost
  port: 25
  username: test@ingenio.local
  password: test-password
  properties:
    mail.smtp.auth: false
    mail.smtp.starttls.enable: false

# OAuth配置（测试环境使用占位符）
oauth:
  google:
    client-id: test-google-client-id
    client-secret: test-google-client-secret
    redirect-uri: http://localhost:3000/auth/google/callback
  github:
    client-id: test-github-client-id
    client-secret: test-github-client-secret
    redirect-uri: http://localhost:3000/auth/github/callback
