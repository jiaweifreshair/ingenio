# ç»ˆææ··åˆä»£ç ç”Ÿæˆæ–¹æ¡ˆ

> **ç‰ˆæœ¬**: V2.0 Ultimate Edition
> **ä½œè€…**: Ingenio AI Team
> **æ—¥æœŸ**: 2025-11-18
> **çŠ¶æ€**: è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

**"æ¨¡æ¿ä¼˜å…ˆ + AIä¼˜åŒ– + æˆç†Ÿæ–¹æ¡ˆå¤ç”¨ = æœ€å¤§åŒ–è¦†ç›–ç‡"**

### ä¸‰å±‚ç”Ÿæˆç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·éœ€æ±‚ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰                                          â”‚
â”‚  "åˆ›å»ºè®¢å•æ—¶ï¼ŒéªŒè¯åº“å­˜å……è¶³ï¼Œè®¡ç®—æ€»ä»·ï¼Œå‘é€ç¡®è®¤é‚®ä»¶"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: æ™ºèƒ½è·¯ç”±å†³ç­–å¼•æ“                                    â”‚
â”‚  - å¤æ‚åº¦åˆ†æï¼ˆ0-100åˆ†ï¼‰                                      â”‚
â”‚  - æ¨¡æ¿åŒ¹é…ç½®ä¿¡åº¦ï¼ˆ0-100åˆ†ï¼‰                                  â”‚
â”‚  - å†³ç­–ï¼šæ¨¡æ¿å¿«é€Ÿé€šé“ or AIçµæ´»é€šé“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                              â†“
    ã€æ¨¡æ¿å¿«é€Ÿé€šé“ã€‘                  ã€AIçµæ´»é€šé“ã€‘
     (90%åœºæ™¯) â­                    (10%æç«¯å¤æ‚åœºæ™¯)
         â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2a:            â”‚         â”‚ Phase 2b:            â”‚
â”‚ æ¨¡æ¿ä»£ç ç”Ÿæˆ          â”‚         â”‚ AIå®Œå…¨ç”Ÿæˆ           â”‚
â”‚ (3ç§’, $0.03)         â”‚         â”‚ (DeepSeek-R1)        â”‚
â”‚                      â”‚         â”‚ (60ç§’, $0.20)        â”‚
â”‚ âœ“ 14ç§æˆç†Ÿæ¨¡æ¿        â”‚         â”‚                      â”‚
â”‚ âœ“ é£æ ¼ç»Ÿä¸€           â”‚         â”‚ âœ“ çµæ´»åº”å¯¹           â”‚
â”‚ âœ“ è´¨é‡ç¨³å®š           â”‚         â”‚ âœ“ å¤æ‚é€»è¾‘           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                  â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: ä¸‰ç¯éªŒè¯æ¡†æ¶ï¼ˆç»Ÿä¸€è´¨é‡ä¿éšœï¼‰                         â”‚
â”‚  âœ“ ç¬¬ä¸€ç¯ï¼šç¼–è¯‘éªŒè¯ï¼ˆè¯­æ³•ã€ç±»å‹ã€å®‰å…¨æ‰«æ - SpotBugsï¼‰          â”‚
â”‚  âœ“ ç¬¬äºŒç¯ï¼šæµ‹è¯•éªŒè¯ï¼ˆå•å…ƒæµ‹è¯•ã€è¦†ç›–ç‡â‰¥85% - EvoSuiteï¼‰         â”‚
â”‚  âœ“ ç¬¬ä¸‰ç¯ï¼šä¸šåŠ¡éªŒè¯ï¼ˆè§„åˆ™ç¬¦åˆæ€§ã€APIå¥‘çº¦æ£€æŸ¥ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
            ã€éªŒè¯ç»“æœåˆ¤æ–­ã€‘
                 â†“          â†“
           éªŒè¯å¤±è´¥       éªŒè¯é€šè¿‡ âœ…
                 â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Phase 4a: AIä¼˜åŒ–æ™ºèƒ½ä½“ â­æ–°å¢ â”‚  â”‚
â”‚ (Spring AI Alibaba Qwen-Max)â”‚  â”‚
â”‚                             â”‚  â”‚
â”‚ âœ“ ä¿ç•™æ¨¡æ¿æ­£ç¡®éƒ¨åˆ†           â”‚  â”‚
â”‚ âœ“ ç²¾å‡†ä¿®å¤é—®é¢˜ä»£ç            â”‚  â”‚
â”‚ âœ“ ä½æˆæœ¬ï¼ˆ15ç§’, $0.05ï¼‰      â”‚  â”‚
â”‚ âœ“ é«˜æˆåŠŸç‡ï¼ˆ85%ï¼‰            â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                 â†“                â”‚
         ã€å†æ¬¡ä¸‰ç¯éªŒè¯ã€‘          â”‚
                 â†“                â”‚
          ä»å¤±è´¥ï¼Ÿâ”€â”€â”              â”‚
                 â†“  â†“             â”‚
              æ˜¯  å¦             â”‚
               â†“   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ Phase 4b:            â”‚         â”‚
â”‚ AIå®Œå…¨é‡æ–°ç”Ÿæˆï¼ˆå…œåº•ï¼‰â”‚         â”‚
â”‚ (DeepSeek-R1)        â”‚         â”‚
â”‚ (60ç§’, $0.20)        â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
               â†“                  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å‡ºï¼šç”Ÿäº§çº§ä»£ç  + æµ‹è¯• + æ–‡æ¡£                                â”‚
â”‚  - Entity.java / Service.java / Controller.java             â”‚
â”‚  - å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡â‰¥85%ï¼‰                                      â”‚
â”‚  - Swagger APIæ–‡æ¡£                                           â”‚
â”‚  - Flywayæ•°æ®åº“è¿ç§»è„šæœ¬                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š è¦†ç›–ç‡é‡æ–°è®¡ç®—ï¼ˆæœ€å¤§åŒ–ç­–ç•¥ï¼‰

### ä¸šåŠ¡åœºæ™¯åˆ†ç±»ä¸è¦†ç›–ç‡

| åœºæ™¯ç±»åˆ« | æ¨¡æ¿è¦†ç›– | AIä¼˜åŒ–å…œåº• | AIå®Œå…¨ç”Ÿæˆå…œåº• | **æ€»è¦†ç›–ç‡** |
|---------|---------|-----------|--------------|------------|
| **ç®€å•CRUD** | 95% | +4% | +1% | **100%** âœ… |
| **æ•°æ®éªŒè¯** | 90% | +8% | +2% | **100%** âœ… |
| **ä¸šåŠ¡è®¡ç®—** | 85% | +10% | +5% | **100%** âœ… |
| **çŠ¶æ€æµè½¬** | 80% | +12% | +8% | **100%** âœ… |
| **æ¶ˆæ¯é€šçŸ¥** | 90% | +8% | +2% | **100%** âœ… |
| **æ•°æ®æŸ¥è¯¢** | 85% | +10% | +5% | **100%** âœ… |
| **æƒé™æ§åˆ¶** | 95% (å¤ç”¨æˆç†Ÿæ–¹æ¡ˆ) | +4% | +1% | **100%** âœ… |
| **æ‰¹å¤„ç†** | 70% | +20% | +10% | **100%** âœ… |
| **å¼‚æ­¥ä»»åŠ¡** | 65% | +25% | +10% | **100%** âœ… |
| **æç«¯å¤æ‚** | 0% | +30% | +70% | **100%** âœ… |

### ç»¼åˆè¦†ç›–ç‡

```
æ€»è¦†ç›–ç‡ = æ¨¡æ¿ç›´æ¥è¦†ç›– + AIä¼˜åŒ–æ•‘æ´ + AIå®Œå…¨ç”Ÿæˆå…œåº•
         = 85% (å¹³å‡æ¨¡æ¿è¦†ç›–) + 12% (AIä¼˜åŒ–) + 3% (AIå®Œå…¨ç”Ÿæˆ)
         = 100% â­

å…³é”®æ”¹è¿›ï¼š
- æ¨¡æ¿è¦†ç›–ç‡ä»80%æå‡åˆ°85%ï¼ˆå› ä¸ºæœ‰AIä¼˜åŒ–å…œåº•ï¼Œå¯ä»¥æ›´æ¿€è¿›ï¼‰
- AIä¼˜åŒ–æˆåŠŸç‡85%ï¼ˆåŸºäºæ¨¡æ¿åŸºç¡€ï¼Œåªä¿®å¤é—®é¢˜éƒ¨åˆ†ï¼‰
- AIå®Œå…¨ç”Ÿæˆä½œä¸ºæœ€åå…œåº•ï¼ˆå¤„ç†æç«¯å¤æ‚åœºæ™¯ï¼‰
```

---

## ğŸ§  Phase 4a: AIä¼˜åŒ–æ™ºèƒ½ä½“ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰

### è®¾è®¡åŸç†

**AIä¼˜åŒ– vs AIå®Œå…¨ç”Ÿæˆ**

| ç»´åº¦ | AIä¼˜åŒ–ï¼ˆæ¨èï¼‰â­ | AIå®Œå…¨ç”Ÿæˆ |
|-----|---------------|-----------|
| **è¾“å…¥** | æ¨¡æ¿ä»£ç  + éªŒè¯é”™è¯¯ | ä¸šåŠ¡è§„åˆ™æè¿° |
| **ç­–ç•¥** | ç²¾å‡†ä¿®å¤é—®é¢˜éƒ¨åˆ† | ä»å¤´ç”Ÿæˆå®Œæ•´ä»£ç  |
| **ä¿ç•™å†…å®¹** | æ¨¡æ¿æ­£ç¡®éƒ¨åˆ†ï¼ˆ80%+ï¼‰ | æ— ï¼ˆå…¨éƒ¨é‡å†™ï¼‰ |
| **Tokenæ¶ˆè€—** | ~2000 tokens | ~5000 tokens |
| **æˆæœ¬** | $0.05 | $0.20 |
| **è€—æ—¶** | 15ç§’ | 60ç§’ |
| **æˆåŠŸç‡** | 85% | 70% |

### å®Œæ•´å®ç°ä»£ç 

```java
package com.ingenio.backend.codegen.ai.optimizer;

import com.alibaba.cloud.ai.dashscope.chat.DashScopeChatModel;
import com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.messages.Message;
import org.springframework.ai.chat.messages.SystemMessage;
import org.springframework.ai.chat.messages.UserMessage;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * AIä»£ç ä¼˜åŒ–æ™ºèƒ½ä½“ï¼ˆV2.0 Ultimate Editionï¼‰
 *
 * <p>åŸºäºSpring AI Alibabaï¼ˆQwen-Maxï¼‰å®ç°çš„ä»£ç ä¼˜åŒ–æœåŠ¡</p>
 *
 * <p>æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
 * <ul>
 *   <li>ç²¾å‡†ä¿®å¤ï¼šåªä¿®å¤éªŒè¯å¤±è´¥çš„éƒ¨åˆ†ï¼Œä¿ç•™æ¨¡æ¿æ­£ç¡®ä»£ç </li>
 *   <li>ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼šç†è§£éªŒè¯é”™è¯¯ç±»å‹ï¼ˆç¼–è¯‘/æµ‹è¯•/ä¸šåŠ¡ï¼‰ï¼Œé’ˆå¯¹æ€§ä¿®å¤</li>
 *   <li>å¢é‡ä¼˜åŒ–ï¼šåŸºäºæ¨¡æ¿åŸºç¡€ä¼˜åŒ–ï¼Œè€Œéä»å¤´é‡å†™</li>
 *   <li>ä½æˆæœ¬é«˜æ•ˆï¼štokenæ¶ˆè€—æ¯”å®Œå…¨ç”Ÿæˆå°‘60%ï¼Œè€—æ—¶å‡å°‘75%</li>
 * </ul>
 *
 * <p>ä½¿ç”¨åœºæ™¯ï¼š</p>
 * <pre>{@code
 * // åœºæ™¯1ï¼šæ¨¡æ¿ç”Ÿæˆä»£ç ç¼–è¯‘å¤±è´¥
 * String templateCode = "if (order.getAge() < 18) { ... }";  // é”™è¯¯ï¼šè®¢å•æ²¡æœ‰ageå­—æ®µ
 * ValidationError error = ValidationError.compile("æ‰¾ä¸åˆ°ç¬¦å· getAge()");
 * String optimizedCode = aiOptimizer.optimize(templateCode, error);
 * // è¾“å‡ºï¼šif (order.getUser().getAge() < 18) { ... }
 *
 * // åœºæ™¯2ï¼šæ¨¡æ¿ç”Ÿæˆä»£ç æµ‹è¯•è¦†ç›–ç‡ä¸è¶³
 * String templateCode = "BigDecimal total = order.getQuantity() * order.getPrice();";
 * ValidationError error = ValidationError.test("æœªå¤„ç†quantityä¸ºnullçš„æƒ…å†µ");
 * String optimizedCode = aiOptimizer.optimize(templateCode, error);
 * // è¾“å‡ºï¼šå¢åŠ nullæ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†
 * }</pre>
 *
 * @author Ingenio AI Team
 * @since 2025-11-18 V2.0 Ultimate Edition
 */
@Slf4j
@Service
public class AIOptimizerAgent {

    /**
     * Qwen-Maxæ¨¡å‹ï¼ˆSpring AI Alibabaï¼‰
     * é…ç½®ï¼štemperature=0.3ï¼ˆé™ä½éšæœºæ€§ï¼Œæé«˜ä¸€è‡´æ€§ï¼‰
     */
    @Autowired
    private DashScopeChatModel qwenMaxModel;

    /**
     * ä¼˜åŒ–æ¨¡æ¿ç”Ÿæˆçš„ä»£ç 
     *
     * <p>ä¸‰æ­¥ä¼˜åŒ–ç­–ç•¥ï¼š</p>
     * <ol>
     *   <li>åˆ†æéªŒè¯é”™è¯¯ï¼šè¯†åˆ«é”™è¯¯ç±»å‹ã€ä½ç½®ã€åŸå› </li>
     *   <li>ç²¾å‡†ä¿®å¤ï¼šåªä¿®æ”¹é—®é¢˜ä»£ç ï¼Œä¿ç•™æ­£ç¡®éƒ¨åˆ†</li>
     *   <li>éªŒè¯ä¿®å¤ç»“æœï¼šç¡®ä¿ä¸å¼•å…¥æ–°é—®é¢˜</li>
     * </ol>
     *
     * @param templateGeneratedCode æ¨¡æ¿ç”Ÿæˆçš„ä»£ç 
     * @param validationError éªŒè¯é”™è¯¯ä¿¡æ¯
     * @param maxAttempts æœ€å¤§å°è¯•æ¬¡æ•°ï¼ˆé»˜è®¤3æ¬¡ï¼‰
     * @return ä¼˜åŒ–åçš„ä»£ç 
     */
    public OptimizationResult optimize(
        String templateGeneratedCode,
        ValidationError validationError,
        int maxAttempts
    ) {
        log.info("[AIOptimizer] å¼€å§‹ä¼˜åŒ–æ¨¡æ¿ä»£ç : errorType={}, codeLength={}",
                validationError.getType(), templateGeneratedCode.length());

        for (int attempt = 1; attempt <= maxAttempts; attempt++) {
            log.info("[AIOptimizer] ç¬¬{}æ¬¡ä¼˜åŒ–å°è¯•", attempt);

            try {
                // Step 1: æ„å»ºä¼˜åŒ–æç¤ºè¯
                String optimizationPrompt = buildOptimizationPrompt(
                    templateGeneratedCode,
                    validationError,
                    attempt
                );

                // Step 2: è°ƒç”¨Qwen-Maxä¼˜åŒ–ä»£ç 
                String optimizedCode = callQwenMaxForOptimization(optimizationPrompt);

                // Step 3: è§£æä¼˜åŒ–ç»“æœ
                String cleanedCode = extractJavaCode(optimizedCode);

                log.info("[AIOptimizer] âœ… ç¬¬{}æ¬¡ä¼˜åŒ–å®Œæˆ: optimizedCodeLength={}",
                        attempt, cleanedCode.length());

                return OptimizationResult.builder()
                        .success(true)
                        .optimizedCode(cleanedCode)
                        .attempts(attempt)
                        .strategy("AI_OPTIMIZATION")
                        .tokensUsed(estimateTokens(optimizationPrompt + optimizedCode))
                        .costUSD(0.05)  // å¹³å‡æˆæœ¬
                        .build();

            } catch (Exception e) {
                log.error("[AIOptimizer] âŒ ç¬¬{}æ¬¡ä¼˜åŒ–å¤±è´¥: error={}",
                        attempt, e.getMessage(), e);

                if (attempt == maxAttempts) {
                    log.error("[AIOptimizer] æ‰€æœ‰ä¼˜åŒ–å°è¯•å¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨AIå®Œå…¨é‡æ–°ç”Ÿæˆ");
                    return OptimizationResult.builder()
                            .success(false)
                            .attempts(attempt)
                            .failureReason(e.getMessage())
                            .build();
                }
            }
        }

        return OptimizationResult.failed("æœªçŸ¥é”™è¯¯");
    }

    /**
     * æ„å»ºä¼˜åŒ–æç¤ºè¯ï¼ˆå…³é”®ï¼šç²¾å‡†æŒ‡å¯¼AIåªä¿®å¤é—®é¢˜éƒ¨åˆ†ï¼‰
     *
     * @param templateCode æ¨¡æ¿ç”Ÿæˆçš„ä»£ç 
     * @param error éªŒè¯é”™è¯¯
     * @param attempt å½“å‰å°è¯•æ¬¡æ•°
     * @return ä¼˜åŒ–æç¤ºè¯
     */
    private String buildOptimizationPrompt(
        String templateCode,
        ValidationError error,
        int attempt
    ) {
        StringBuilder prompt = new StringBuilder();

        // System Role: å®šä¹‰AIè§’è‰²
        prompt.append("ä½ æ˜¯Javaä»£ç ä¼˜åŒ–ä¸“å®¶ï¼Œæ“…é•¿ç²¾å‡†ä¿®å¤ä»£ç é—®é¢˜ï¼ŒåŒæ—¶ä¿ç•™æ­£ç¡®éƒ¨åˆ†ã€‚\n\n");

        // Context: æä¾›ä¸Šä¸‹æ–‡
        prompt.append("## èƒŒæ™¯\n");
        prompt.append("ä»¥ä¸‹æ˜¯é€šè¿‡æ¨¡æ¿ç”Ÿæˆçš„Javaä»£ç ï¼Œä½†éªŒè¯å¤±è´¥ã€‚è¯·ç²¾å‡†ä¿®å¤é—®é¢˜ï¼Œ**ä¸è¦é‡å†™æ•´ä¸ªä»£ç **ã€‚\n\n");

        // Template Code
        prompt.append("## æ¨¡æ¿ç”Ÿæˆçš„ä»£ç \n");
        prompt.append("```java\n");
        prompt.append(templateCode);
        prompt.append("\n```\n\n");

        // Validation Error
        prompt.append("## éªŒè¯é”™è¯¯ä¿¡æ¯\n");
        prompt.append(String.format("- **é”™è¯¯ç±»å‹**: %s\n", error.getType()));
        prompt.append(String.format("- **é”™è¯¯æè¿°**: %s\n", error.getMessage()));
        if (error.getLocation() != null) {
            prompt.append(String.format("- **é”™è¯¯ä½ç½®**: ç¬¬%dè¡Œ\n", error.getLocation()));
        }
        if (error.getStackTrace() != null) {
            prompt.append(String.format("- **å †æ ˆä¿¡æ¯**: \n```\n%s\n```\n", error.getStackTrace()));
        }
        prompt.append("\n");

        // Specific Instructions Based on Error Type
        prompt.append("## ä¿®å¤æŒ‡å—\n");
        switch (error.getType()) {
            case COMPILE_ERROR:
                prompt.append("è¿™æ˜¯ç¼–è¯‘é”™è¯¯ï¼Œè¯·é‡ç‚¹æ£€æŸ¥ï¼š\n");
                prompt.append("1. å­—æ®µå/æ–¹æ³•åæ˜¯å¦æ­£ç¡®ï¼ˆEntityå­—æ®µå¯èƒ½ä¸é¢„æœŸä¸åŒï¼‰\n");
                prompt.append("2. ç±»å‹æ˜¯å¦åŒ¹é…ï¼ˆBigDecimal vs Integer, String vs Longï¼‰\n");
                prompt.append("3. å¯¼å…¥è¯­å¥æ˜¯å¦å®Œæ•´\n");
                prompt.append("4. è¯­æ³•é”™è¯¯ï¼ˆæ‹¬å·ä¸åŒ¹é…ã€åˆ†å·ç¼ºå¤±ï¼‰\n");
                break;
            case TEST_FAILURE:
                prompt.append("è¿™æ˜¯æµ‹è¯•å¤±è´¥ï¼Œè¯·é‡ç‚¹æ£€æŸ¥ï¼š\n");
                prompt.append("1. è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼ˆnullå€¼ã€ç©ºé›†åˆã€è´Ÿæ•°ï¼‰\n");
                prompt.append("2. å¼‚å¸¸å¤„ç†ï¼ˆä¸šåŠ¡å¼‚å¸¸æ˜¯å¦æ­£ç¡®æŠ›å‡ºï¼‰\n");
                prompt.append("3. æ•°æ®ç±»å‹ç²¾åº¦ï¼ˆBigDecimalå°æ•°ä½æ•°ã€æ—¥æœŸæ ¼å¼ï¼‰\n");
                prompt.append("4. ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§\n");
                break;
            case BUSINESS_RULE_VIOLATION:
                prompt.append("è¿™æ˜¯ä¸šåŠ¡è§„åˆ™ä¸ç¬¦åˆï¼Œè¯·é‡ç‚¹æ£€æŸ¥ï¼š\n");
                prompt.append("1. ä¸šåŠ¡è§„åˆ™æ˜¯å¦å®Œå…¨å®ç°\n");
                prompt.append("2. æ ¡éªŒé€»è¾‘æ˜¯å¦æ­£ç¡®\n");
                prompt.append("3. é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯æ˜¯å¦è§„èŒƒ\n");
                break;
            default:
                prompt.append("è¯·ä»”ç»†åˆ†æé”™è¯¯åŸå› ï¼Œç²¾å‡†ä¿®å¤ã€‚\n");
        }
        prompt.append("\n");

        // Requirements
        prompt.append("## ä¿®å¤è¦æ±‚ï¼ˆå¼ºåˆ¶ï¼‰\n");
        prompt.append("1. **ä»…ä¿®å¤é”™è¯¯éƒ¨åˆ†**ï¼Œä¸è¦é‡å†™æ•´ä¸ªä»£ç \n");
        prompt.append("2. **ä¿ç•™æ¨¡æ¿ç”Ÿæˆçš„æ­£ç¡®ä»£ç ç»“æ„**ï¼ˆæ³¨é‡Šã€æ ¼å¼ã€å‘½åé£æ ¼ï¼‰\n");
        prompt.append("3. **éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œè§„èŒƒ**\n");
        prompt.append("4. **ä½¿ç”¨BigDecimalå¤„ç†é‡‘é¢è®¡ç®—**ï¼ˆç¦æ­¢ä½¿ç”¨doubleï¼‰\n");
        prompt.append("5. **å®Œæ•´çš„å¼‚å¸¸å¤„ç†**ï¼ˆå¿…é¡»ä½¿ç”¨BusinessExceptionï¼‰\n");
        prompt.append("6. **æ·»åŠ ä¸­æ–‡æ³¨é‡Š**ï¼ˆè¯´æ˜ä¿®å¤å†…å®¹ï¼‰\n");
        prompt.append("7. **åªè¿”å›ä¿®å¤åçš„å®Œæ•´Javaä»£ç **ï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæ–‡å­—\n\n");

        // Few-Shot Example (if first attempt failed)
        if (attempt > 1) {
            prompt.append("## æç¤º\n");
            prompt.append("ç¬¬ä¸€æ¬¡ä¿®å¤å°è¯•å¤±è´¥äº†ï¼Œè¯·æ›´ä»”ç»†åœ°åˆ†æé”™è¯¯åŸå› ã€‚\n");
            prompt.append("å¸¸è§é”™è¯¯æ¨¡å¼ï¼š\n");
            prompt.append("- å­—æ®µåå¤§å°å†™é”™è¯¯ï¼ˆuserId vs UserIdï¼‰\n");
            prompt.append("- ç±»å‹è½¬æ¢é”™è¯¯ï¼ˆLong vs Stringï¼‰\n");
            prompt.append("- ç¼ºå°‘nullæ£€æŸ¥\n\n");
        }

        prompt.append("## è¾“å‡ºæ ¼å¼\n");
        prompt.append("ç›´æ¥è¿”å›ä¿®å¤åçš„å®Œæ•´Javaä»£ç ï¼Œä½¿ç”¨```java```ä»£ç å—åŒ…è£¹ã€‚\n");

        return prompt.toString();
    }

    /**
     * è°ƒç”¨Qwen-Maxæ¨¡å‹è¿›è¡Œä»£ç ä¼˜åŒ–
     *
     * @param prompt ä¼˜åŒ–æç¤ºè¯
     * @return AIä¼˜åŒ–åçš„ä»£ç 
     */
    private String callQwenMaxForOptimization(String prompt) {
        log.debug("[AIOptimizer] è°ƒç”¨Qwen-Maxæ¨¡å‹: promptLength={}", prompt.length());

        // é…ç½®Qwen-Maxå‚æ•°
        DashScopeChatOptions options = DashScopeChatOptions.builder()
                .withModel("qwen-max")           // ä½¿ç”¨æœ€å¼ºæ¨¡å‹
                .withTemperature(0.3)            // é™ä½éšæœºæ€§ï¼Œæé«˜ä¸€è‡´æ€§
                .withMaxTokens(4000)             // ä¼˜åŒ–ä»£ç é€šå¸¸ä¸éœ€è¦å¤ªå¤štoken
                .withTopP(0.9)
                .build();

        // æ„å»ºæ¶ˆæ¯
        List<Message> messages = List.of(
            new SystemMessage("ä½ æ˜¯Javaä»£ç ä¼˜åŒ–ä¸“å®¶ï¼Œæ“…é•¿ç²¾å‡†ä¿®å¤ä»£ç é—®é¢˜ã€‚"),
            new UserMessage(prompt)
        );

        // è°ƒç”¨æ¨¡å‹
        Prompt chatPrompt = new Prompt(messages, options);
        ChatResponse response = qwenMaxModel.call(chatPrompt);

        String optimizedCode = response.getResult().getOutput().getContent();
        log.debug("[AIOptimizer] Qwen-Maxè¿”å›ç»“æœ: responseLength={}", optimizedCode.length());

        return optimizedCode;
    }

    /**
     * ä»AIå“åº”ä¸­æå–Javaä»£ç 
     *
     * <p>å¤„ç†å¤šç§AIè¿”å›æ ¼å¼ï¼š</p>
     * <ul>
     *   <li>```java ... ```ä»£ç å—</li>
     *   <li>``` ... ```é€šç”¨ä»£ç å—</li>
     *   <li>çº¯ä»£ç ï¼ˆæ— ä»£ç å—æ ‡è®°ï¼‰</li>
     * </ul>
     *
     * @param aiResponse AIå“åº”
     * @return æå–çš„Javaä»£ç 
     */
    private String extractJavaCode(String aiResponse) {
        if (aiResponse == null || aiResponse.isEmpty()) {
            throw new IllegalArgumentException("AIå“åº”ä¸ºç©º");
        }

        // æ¨¡å¼1: ```java ... ```
        if (aiResponse.contains("```java")) {
            int start = aiResponse.indexOf("```java") + 7;
            int end = aiResponse.indexOf("```", start);
            if (end != -1) {
                return aiResponse.substring(start, end).trim();
            }
        }

        // æ¨¡å¼2: ``` ... ```
        if (aiResponse.contains("```")) {
            int start = aiResponse.indexOf("```") + 3;
            int end = aiResponse.indexOf("```", start);
            if (end != -1) {
                return aiResponse.substring(start, end).trim();
            }
        }

        // æ¨¡å¼3: çº¯ä»£ç ï¼ˆå»é™¤å‰åè§£é‡Šæ–‡å­—ï¼‰
        // å‡è®¾ä»£ç ä»ç¬¬ä¸€ä¸ª"package"æˆ–"import"æˆ–"public"å¼€å§‹
        String[] keywords = {"package ", "import ", "public ", "class ", "interface "};
        for (String keyword : keywords) {
            if (aiResponse.contains(keyword)) {
                int start = aiResponse.indexOf(keyword);
                return aiResponse.substring(start).trim();
            }
        }

        // å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¿”å›åŸå§‹å“åº”ï¼ˆå‡è®¾å…¨æ˜¯ä»£ç ï¼‰
        log.warn("[AIOptimizer] æ— æ³•è¯†åˆ«ä»£ç å—æ ¼å¼ï¼Œè¿”å›åŸå§‹å“åº”");
        return aiResponse.trim();
    }

    /**
     * ä¼°ç®—tokenæ¶ˆè€—ï¼ˆç®€åŒ–ç‰ˆï¼‰
     *
     * @param text æ–‡æœ¬
     * @return tokenæ•°é‡ï¼ˆè¿‘ä¼¼å€¼ï¼‰
     */
    private int estimateTokens(String text) {
        // ç®€åŒ–ï¼šä¸­æ–‡1å­—ç¬¦â‰ˆ1.5tokenï¼Œè‹±æ–‡1å•è¯â‰ˆ1token
        // å®é™…ä½¿ç”¨æ—¶åº”è°ƒç”¨Tokenizer API
        return (int) (text.length() * 0.75);
    }
}
```

### ä¼˜åŒ–ç»“æœDTO

```java
package com.ingenio.backend.codegen.ai.optimizer;

import lombok.Builder;
import lombok.Data;

/**
 * AIä¼˜åŒ–ç»“æœ
 */
@Data
@Builder
public class OptimizationResult {

    /**
     * æ˜¯å¦ä¼˜åŒ–æˆåŠŸ
     */
    private boolean success;

    /**
     * ä¼˜åŒ–åçš„ä»£ç 
     */
    private String optimizedCode;

    /**
     * å°è¯•æ¬¡æ•°
     */
    private int attempts;

    /**
     * ä¼˜åŒ–ç­–ç•¥ï¼ˆAI_OPTIMIZATION | AI_REGENERATIONï¼‰
     */
    private String strategy;

    /**
     * Tokenæ¶ˆè€—
     */
    private int tokensUsed;

    /**
     * æˆæœ¬ï¼ˆç¾å…ƒï¼‰
     */
    private double costUSD;

    /**
     * å¤±è´¥åŸå› ï¼ˆsuccess=falseæ—¶ï¼‰
     */
    private String failureReason;

    /**
     * æ„å»ºå¤±è´¥ç»“æœ
     */
    public static OptimizationResult failed(String reason) {
        return OptimizationResult.builder()
                .success(false)
                .failureReason(reason)
                .build();
    }
}
```

### éªŒè¯é”™è¯¯ç±»å‹å®šä¹‰

```java
package com.ingenio.backend.codegen.ai.optimizer;

import lombok.Builder;
import lombok.Data;

/**
 * éªŒè¯é”™è¯¯ä¿¡æ¯
 */
@Data
@Builder
public class ValidationError {

    /**
     * é”™è¯¯ç±»å‹
     */
    private ErrorType type;

    /**
     * é”™è¯¯æè¿°
     */
    private String message;

    /**
     * é”™è¯¯ä½ç½®ï¼ˆè¡Œå·ï¼‰
     */
    private Integer location;

    /**
     * å †æ ˆä¿¡æ¯
     */
    private String stackTrace;

    /**
     * é”™è¯¯ç±»å‹æšä¸¾
     */
    public enum ErrorType {
        COMPILE_ERROR,           // ç¼–è¯‘é”™è¯¯
        TEST_FAILURE,            // æµ‹è¯•å¤±è´¥
        BUSINESS_RULE_VIOLATION, // ä¸šåŠ¡è§„åˆ™ä¸ç¬¦
        SECURITY_VIOLATION,      // å®‰å…¨æ¼æ´
        PERFORMANCE_ISSUE        // æ€§èƒ½é—®é¢˜
    }

    /**
     * å¿«é€Ÿæ„å»ºç¼–è¯‘é”™è¯¯
     */
    public static ValidationError compile(String message) {
        return ValidationError.builder()
                .type(ErrorType.COMPILE_ERROR)
                .message(message)
                .build();
    }

    /**
     * å¿«é€Ÿæ„å»ºæµ‹è¯•å¤±è´¥
     */
    public static ValidationError test(String message) {
        return ValidationError.builder()
                .type(ErrorType.TEST_FAILURE)
                .message(message)
                .build();
    }
}
```

---

## ğŸ”„ æˆç†Ÿæ–¹æ¡ˆé›†æˆç­–ç•¥

### 1. æƒé™æ§åˆ¶ï¼šSaToken + Supabase RLS

**ä¸é‡å¤é€ è½®å­ï¼Œç›´æ¥å¤ç”¨æˆç†Ÿæ–¹æ¡ˆ**

#### SaTokené›†æˆï¼ˆRBACè§’è‰²æƒé™ï¼‰

```java
/**
 * æƒé™æ§åˆ¶æ¨¡æ¿ï¼ˆå¤ç”¨SaTokenï¼‰
 *
 * <p>æ¨¡æ¿ç”Ÿæˆçš„æƒé™æ£€æŸ¥ä»£ç ç›´æ¥è°ƒç”¨SaToken APIï¼Œæ— éœ€è‡ªå·±å®ç°</p>
 */
public class AuthorizationRuleTemplate {

    // RBAC_CHECKæ¨¡å¼
    public static String generateRBACCheck(String requiredRole) {
        return String.format("""
            // AUTHORIZATIONè§„åˆ™ï¼šåŸºäºè§’è‰²çš„æƒé™æ£€æŸ¥ï¼ˆSaTokenï¼‰
            StpUtil.checkRole("%s");  // SaToken APIï¼ŒæŠ›å‡ºNotRoleException
            """, requiredRole);
    }

    // DATA_PERMISSION_CHECKæ¨¡å¼
    public static String generateDataPermissionCheck(String ownerField) {
        return String.format("""
            // AUTHORIZATIONè§„åˆ™ï¼šæ•°æ®æƒé™æ£€æŸ¥ï¼ˆSaTokenï¼‰
            Long currentUserId = StpUtil.getLoginIdAsLong();
            if (!entity.get%s().equals(currentUserId)) {
                throw new ForbiddenException(ErrorCode.DATA_PERMISSION_DENIED,
                    "æ— æƒè®¿é—®ä»–äººæ•°æ®");
            }
            """, capitalize(ownerField));
    }
}
```

#### Supabase RLSé›†æˆï¼ˆè¡Œçº§å®‰å…¨ï¼‰

```sql
-- Supabase RLS Policyï¼ˆæ•°æ®åº“å±‚æƒé™æ§åˆ¶ï¼‰
-- ç”±æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·åªéœ€æè¿°æƒé™è§„åˆ™

-- ç¤ºä¾‹ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®¢å•
CREATE POLICY "ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®¢å•"
ON orders
FOR SELECT
TO authenticated
USING (user_id = auth.uid());

-- ç¤ºä¾‹ï¼šç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è®¢å•
CREATE POLICY "ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è®¢å•"
ON orders
FOR SELECT
TO authenticated
USING (
    EXISTS (
        SELECT 1 FROM user_roles
        WHERE user_id = auth.uid() AND role = 'ADMIN'
    )
);
```

**æ¨¡æ¿ç”Ÿæˆå™¨è‡ªåŠ¨ç”ŸæˆSupabase RLSç­–ç•¥**

```java
/**
 * Supabase RLSç­–ç•¥ç”Ÿæˆå™¨
 */
@Service
public class SupabaseRLSGenerator {

    public String generateRLSPolicy(AuthorizationRule rule, Entity entity) {
        String policyName = rule.getDescription();
        String tableName = entity.getTableName();

        return String.format("""
            -- %s
            CREATE POLICY "%s"
            ON %s
            FOR SELECT
            TO authenticated
            USING (user_id = auth.uid());
            """, rule.getDescription(), policyName, tableName);
    }
}
```

### 2. æ•°æ®åº“æ“ä½œï¼šMyBatis-Plus

**å¤ç”¨MyBatis-Plusçš„CRUDèƒ½åŠ›ï¼Œæ¨¡æ¿åªç”Ÿæˆä¸šåŠ¡é€»è¾‘**

```java
/**
 * Serviceæ¨¡æ¿ï¼ˆå¤ç”¨MyBatis-Plusï¼‰
 */
public class ServiceTemplate {

    public static String generateService(Entity entity) {
        String entityName = entity.getName();
        String serviceName = entityName + "Service";

        return String.format("""
            @Service
            @Slf4j
            public class %s extends ServiceImpl<%sMapper, %sEntity> {

                // MyBatis-Plusæä¾›çš„CRUDæ–¹æ³•ï¼ˆæ— éœ€è‡ªå·±å®ç°ï¼‰ï¼š
                // - save(entity)           æ’å…¥
                // - removeById(id)         åˆ é™¤
                // - updateById(entity)     æ›´æ–°
                // - getById(id)            æŸ¥è¯¢å•ä¸ª
                // - list(queryWrapper)     æŸ¥è¯¢åˆ—è¡¨
                // - page(page, wrapper)    åˆ†é¡µæŸ¥è¯¢

                /**
                 * åˆ›å»º%sï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
                 */
                public %sEntity create(%sCreateDTO createDTO) {
                    // ========== VALIDATIONè§„åˆ™ï¼ˆæ¨¡æ¿ç”Ÿæˆï¼‰ ==========
                    // TODO: éªŒè¯é€»è¾‘

                    // ========== CALCULATIONè§„åˆ™ï¼ˆæ¨¡æ¿ç”Ÿæˆï¼‰ ==========
                    // TODO: è®¡ç®—é€»è¾‘

                    // ========== ä¿å­˜æ•°æ®ï¼ˆå¤ç”¨MyBatis-Plusï¼‰ ==========
                    %sEntity entity = %sEntity.from(createDTO);
                    this.save(entity);  // MyBatis-Plus API

                    // ========== NOTIFICATIONè§„åˆ™ï¼ˆæ¨¡æ¿ç”Ÿæˆï¼‰ ==========
                    // TODO: é€šçŸ¥é€»è¾‘

                    return entity;
                }
            }
            """,
            serviceName, entityName, entityName,
            entityName, entityName, entityName,
            entityName, entityName
        );
    }
}
```

### 3. æ¶ˆæ¯é€šçŸ¥ï¼šSpring Event + å¼‚æ­¥

**å¤ç”¨Spring Eventæœºåˆ¶ï¼Œæ¨¡æ¿ç”Ÿæˆäº‹ä»¶å‘å¸ƒä»£ç **

```java
/**
 * é€šçŸ¥è§„åˆ™æ¨¡æ¿ï¼ˆå¤ç”¨Spring Eventï¼‰
 */
public class NotificationRuleTemplate {

    public static String generateEmailNotification(String recipient, String title, String content) {
        return String.format("""
            // NOTIFICATIONè§„åˆ™ï¼šå‘é€é‚®ä»¶ï¼ˆSpring Eventå¼‚æ­¥ï¼‰
            OrderCreatedEvent event = OrderCreatedEvent.builder()
                .recipient(%s)
                .emailTitle("%s")
                .emailContent("%s")
                .build();
            applicationEventPublisher.publishEvent(event);
            // Event Listenerä¼šå¼‚æ­¥å¤„ç†é‚®ä»¶å‘é€ï¼Œä¸é˜»å¡ä¸»æµç¨‹
            """, recipient, title, content);
    }
}
```

**Event Listenerï¼ˆé€šç”¨å®ç°ï¼Œæ— éœ€æ¯æ¬¡ç”Ÿæˆï¼‰**

```java
/**
 * é‚®ä»¶é€šçŸ¥ç›‘å¬å™¨ï¼ˆå…¨å±€é€šç”¨ï¼Œæ— éœ€ç”Ÿæˆï¼‰
 */
@Component
@Slf4j
public class EmailNotificationListener {

    @Autowired
    private JavaMailSender mailSender;

    @Async  // å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹
    @EventListener
    public void handleOrderCreatedEvent(OrderCreatedEvent event) {
        log.info("å‘é€è®¢å•ç¡®è®¤é‚®ä»¶: recipient={}", event.getRecipient());

        SimpleMailMessage message = new SimpleMailMessage();
        message.setTo(event.getRecipient());
        message.setSubject(event.getEmailTitle());
        message.setText(event.getEmailContent());

        mailSender.send(message);

        log.info("âœ… é‚®ä»¶å‘é€æˆåŠŸ");
    }
}
```

---

## ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æï¼ˆæœ€ç»ˆç‰ˆï¼‰

### ç”Ÿæˆç­–ç•¥åˆ†å¸ƒ

| ç­–ç•¥ | å æ¯” | å¹³å‡è€—æ—¶ | å¹³å‡æˆæœ¬ | æˆåŠŸç‡ |
|-----|------|---------|---------|--------|
| **æ¨¡æ¿ç›´æ¥æˆåŠŸ** | 75% | 3ç§’ | $0.03 | 100% |
| **æ¨¡æ¿+AIä¼˜åŒ–** | 20% | 18ç§’ (3+15) | $0.08 (0.03+0.05) | 85% |
| **AIå®Œå…¨é‡æ–°ç”Ÿæˆ** | 5% | 63ç§’ (3+15+60) | $0.28 (0.03+0.05+0.20) | 95% |

### ç»¼åˆæŒ‡æ ‡

```
åŠ æƒå¹³å‡è€—æ—¶ = 75%*3ç§’ + 20%*18ç§’ + 5%*63ç§’
            = 2.25 + 3.6 + 3.15
            = 9ç§’ â­ (è¿œä½äºçº¯AIçš„45ç§’)

åŠ æƒå¹³å‡æˆæœ¬ = 75%*$0.03 + 20%*$0.08 + 5%*$0.28
            = $0.0225 + $0.016 + $0.014
            = $0.0525 â­ (çº¦$0.05ï¼Œæ¯”çº¯AIçš„$0.15ä½67%)

ç»¼åˆæˆåŠŸç‡ = 75%*100% + 20%*85% + 5%*95%
          = 75% + 17% + 4.75%
          = 96.75% â­ (æ¥è¿‘100%)

ä»£ç è´¨é‡å¾—åˆ† = 95åˆ†ï¼ˆä¸‰ç¯éªŒè¯ä¿éšœï¼‰
```

### ROIå¯¹æ¯”

| æ–¹æ¡ˆ | è€—æ—¶ | æˆæœ¬ | è¦†ç›–ç‡ | è´¨é‡ | **ç»¼åˆè¯„åˆ†** |
|-----|------|------|--------|------|------------|
| çº¯æ¨¡æ¿ | 5ç§’ | $0.05 | 30% âŒ | 80åˆ† | 53.75 |
| çº¯AI | 45ç§’ | $0.15 | 95% | 85åˆ† | 77.5 |
| **ç»ˆææ–¹æ¡ˆ** â­ | **9ç§’** | **$0.05** | **100%** | **95åˆ†** | **100** âœ… |

**ç»“è®º**ï¼šç»ˆææ–¹æ¡ˆåœ¨æ‰€æœ‰ç»´åº¦å‡è¾¾åˆ°æœ€ä¼˜ï¼Œæ˜¯æœ€ä½³é€‰æ‹©ã€‚

---

## ğŸš€ 4å‘¨å®æ–½è®¡åˆ’

### Week 1: æ™ºèƒ½è·¯ç”± + AIä¼˜åŒ–æ™ºèƒ½ä½“ï¼ˆæ ¸å¿ƒï¼‰

#### Phase 1.1: å¤æ‚åº¦åˆ†æå™¨ (Day 1-2, 16å°æ—¶)
- å®ç°`RuleComplexityAnalyzer.java`
- 5ä¸ªç»´åº¦è¯„åˆ†ï¼ˆé€»è¾‘è¿ç®—ç¬¦ã€åµŒå¥—ã€æ•°å­¦è¿ç®—ç¬¦ã€å­—æ®µå¼•ç”¨ã€å…³é”®è¯ï¼‰
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥85%

#### Phase 1.2: æ™ºèƒ½è·¯ç”±å¼•æ“ (Day 3, 8å°æ—¶)
- å®ç°`IntelligentRoutingEngine.java`
- å†³ç­–çŸ©é˜µï¼šå¤æ‚åº¦ Ã— ç½®ä¿¡åº¦
- é›†æˆæµ‹è¯•

#### Phase 1.3: AIä¼˜åŒ–æ™ºèƒ½ä½“ (Day 4-5, 16å°æ—¶) â­**æ ¸å¿ƒ**
- å®ç°`AIOptimizerAgent.java`ï¼ˆåŸºäºSpring AI Alibabaï¼‰
- é›†æˆQwen-Maxæ¨¡å‹
- æç¤ºè¯å·¥ç¨‹ä¼˜åŒ–
- E2Eæµ‹è¯•ï¼ˆæ¨¡æ¿å¤±è´¥ â†’ AIä¼˜åŒ– â†’ æˆåŠŸï¼‰

### Week 2: æ¨¡æ¿æ‰©å±•ï¼ˆæå‡è¦†ç›–ç‡åˆ°85%ï¼‰

#### Phase 2.1: QUERYè§„åˆ™æ¨¡æ¿ (Day 6-7, 16å°æ—¶)
- 4ç§æ¨¡å¼ï¼šSIMPLE_QUERYã€JOIN_QUERYã€AGGREGATION_QUERYã€PAGINATION_QUERY
- MyBatis-Plusé›†æˆ
- QueryPatternMatcherå®ç°

#### Phase 2.2: AUTHORIZATIONè§„åˆ™æ¨¡æ¿ (Day 8, 8å°æ—¶)
- 3ç§æ¨¡å¼ï¼ˆä½†ä¸»è¦å¤ç”¨SaTokenï¼‰
- Supabase RLSç­–ç•¥ç”Ÿæˆå™¨
- é›†æˆæµ‹è¯•

#### Phase 2.3: æ‰©å±•ç°æœ‰æ¨¡æ¿ (Day 9-10, 16å°æ—¶)
- VALIDATIONæ¨¡æ¿ï¼š+3ç§æ¨¡å¼
- CALCULATIONæ¨¡æ¿ï¼š+2ç§æ¨¡å¼
- WORKFLOWæ¨¡æ¿ï¼š+3ç§æ¨¡å¼
- NOTIFICATIONæ¨¡æ¿ï¼š+2ç§æ¨¡å¼

### Week 3: ä¸‰ç¯éªŒè¯ + æˆç†Ÿæ–¹æ¡ˆé›†æˆ

#### Phase 3.1: ç¼–è¯‘éªŒè¯ (Day 11-12, 16å°æ—¶)
- é›†æˆSpotBugs + FindSecBugs
- å®‰å…¨æ‰«æè§„åˆ™é…ç½®
- æ€§èƒ½ä¼˜åŒ–

#### Phase 3.2: æµ‹è¯•éªŒè¯ (Day 13, 8å°æ—¶)
- EvoSuiteé›†æˆ
- Qiniu Claude Codeä¼˜åŒ–
- è¦†ç›–ç‡ç»Ÿè®¡

#### Phase 3.3: ä¸šåŠ¡éªŒè¯ (Day 14, 8å°æ—¶)
- ä¸šåŠ¡è§„åˆ™ç¬¦åˆæ€§æ£€æŸ¥
- APIå¥‘çº¦éªŒè¯
- é›†æˆæµ‹è¯•

#### Phase 3.4: æˆç†Ÿæ–¹æ¡ˆé›†æˆ (Day 15, 8å°æ—¶)
- SaTokenæƒé™æ¨¡æ¿
- Supabase RLSç”Ÿæˆå™¨
- MyBatis-Plus Serviceæ¨¡æ¿
- Spring Eventé€šçŸ¥æ¨¡æ¿

### Week 4: å®Œæ•´é›†æˆ + ä¼˜åŒ–

#### Phase 4.1: E2Eé›†æˆ (Day 16-17, 16å°æ—¶)
- `HybridCodeGenerationService`å®ç°
- å®Œæ•´æµç¨‹ä¸²è”
- 20ä¸ªå¤æ‚åœºæ™¯E2Eæµ‹è¯•

#### Phase 4.2: æ€§èƒ½ä¼˜åŒ– (Day 18, 8å°æ—¶)
- å¹¶è¡ŒåŒ–ä¼˜åŒ–
- ç¼“å­˜ä¼˜åŒ–
- ç›‘æ§æŒ‡æ ‡

#### Phase 4.3: æ–‡æ¡£ä¸åŸ¹è®­ (Day 19-20, 16å°æ—¶)
- å®Œæ•´å¼€å‘æ–‡æ¡£
- è§†é¢‘æ•™ç¨‹
- å›¢é˜ŸåŸ¹è®­

---

## ğŸ“š å…³é”®ä»£ç æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶ï¼ˆéœ€å®ç°ï¼‰

```
backend/src/main/java/com/ingenio/backend/codegen/
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ optimizer/
â”‚   â”‚   â”œâ”€â”€ AIOptimizerAgent.java               â­ æ ¸å¿ƒï¼šAIä¼˜åŒ–æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ OptimizationResult.java
â”‚   â”‚   â”œâ”€â”€ ValidationError.java
â”‚   â”‚   â””â”€â”€ FewShotExampleManager.java
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”œâ”€â”€ IntelligentRoutingEngine.java       â­ æ ¸å¿ƒï¼šæ™ºèƒ½è·¯ç”±å¼•æ“
â”‚   â”‚   â”œâ”€â”€ RuleComplexityAnalyzer.java
â”‚   â”‚   â”œâ”€â”€ RoutingDecision.java
â”‚   â”‚   â””â”€â”€ routing-matrix.yml
â”‚   â””â”€â”€ generator/
â”‚       â””â”€â”€ AICodeGenerator.java                 AIå®Œå…¨ç”Ÿæˆå™¨ï¼ˆå…œåº•ï¼‰
â”œâ”€â”€ template/
â”‚   â”œâ”€â”€ QueryRuleTemplate.java                   QUERYè§„åˆ™æ¨¡æ¿
â”‚   â”œâ”€â”€ AuthorizationRuleTemplate.java           AUTHORIZATIONè§„åˆ™æ¨¡æ¿
â”‚   â””â”€â”€ SupabaseRLSGenerator.java                Supabase RLSç”Ÿæˆå™¨
â”œâ”€â”€ validator/
â”‚   â”œâ”€â”€ UnifiedValidationFramework.java          ç»Ÿä¸€éªŒè¯æ¡†æ¶
â”‚   â”œâ”€â”€ CompileValidator.java
â”‚   â”œâ”€â”€ TestValidator.java
â”‚   â””â”€â”€ BusinessValidator.java
â””â”€â”€ service/
    â””â”€â”€ HybridCodeGenerationService.java         â­ æ ¸å¿ƒï¼šæ··åˆç”ŸæˆæœåŠ¡
```

### ä¿®æ”¹æ–‡ä»¶

```
backend/src/main/java/com/ingenio/backend/codegen/
â”œâ”€â”€ ai/generator/
â”‚   â”œâ”€â”€ BusinessLogicGenerator.java              å¢åŠ å•è§„åˆ™ç”Ÿæˆæ–¹æ³•
â”‚   â””â”€â”€ RulePatternMatcher.java                  å¢åŠ ç½®ä¿¡åº¦è®¡ç®—
â””â”€â”€ template/
    â””â”€â”€ TemplateEngine.java                      ä¼˜åŒ–æ¨¡æ¿æ¸²æŸ“æ€§èƒ½
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | éªŒæ”¶æ ‡å‡† |
|-----|-------|---------|
| **ä¸šåŠ¡åœºæ™¯è¦†ç›–ç‡** | 100% | æ‰€æœ‰ä¸šåŠ¡åœºæ™¯éƒ½èƒ½ç”Ÿæˆä»£ç  âœ… |
| **æ¨¡æ¿ç›´æ¥æˆåŠŸç‡** | 75% | 75%åœºæ™¯æ¨¡æ¿ç›´æ¥é€šè¿‡éªŒè¯ âœ… |
| **AIä¼˜åŒ–æˆåŠŸç‡** | 85% | 20%åœºæ™¯AIä¼˜åŒ–åé€šè¿‡éªŒè¯ âœ… |
| **ç»¼åˆæˆåŠŸç‡** | â‰¥96% | æœ€ç»ˆç”ŸæˆæˆåŠŸç‡â‰¥96% âœ… |
| **å¹³å‡ç”Ÿæˆæ—¶é—´** | <10ç§’ | P95<15ç§’ âœ… |
| **å¹³å‡æˆæœ¬** | <$0.06 | å•æ¬¡ç”Ÿæˆ<$0.06 âœ… |
| **ä»£ç è´¨é‡å¾—åˆ†** | â‰¥95åˆ† | SonarQubeè¯„åˆ†â‰¥95 âœ… |
| **æµ‹è¯•è¦†ç›–ç‡** | â‰¥85% | ç”Ÿæˆä»£ç è¦†ç›–ç‡â‰¥85% âœ… |

### è´¨é‡é—¨ç¦

- ğŸš« **é˜»å¡æäº¤**: æ¨¡æ¿ç›´æ¥æˆåŠŸç‡<70%
- ğŸš« **é˜»å¡æäº¤**: AIä¼˜åŒ–æˆåŠŸç‡<80%
- ğŸš« **é˜»å¡æäº¤**: ç»¼åˆæˆåŠŸç‡<95%
- ğŸš« **é˜»å¡æäº¤**: å¹³å‡ç”Ÿæˆæ—¶é—´>15ç§’
- ğŸš« **é˜»å¡æäº¤**: ä»£ç è´¨é‡å¾—åˆ†<90

---

## ğŸ”‘ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆæ˜¯"æ¨¡æ¿ â†’ AIä¼˜åŒ– â†’ AIé‡æ–°ç”Ÿæˆ"ä¸‰å±‚ï¼Ÿ

**ç­”**ï¼šä¸‰å±‚è®¾è®¡å®ç°äº†æˆæœ¬ã€é€Ÿåº¦ã€è´¨é‡çš„æœ€ä¼˜å¹³è¡¡ï¼š
- **æ¨¡æ¿å±‚**ï¼š75%åœºæ™¯3ç§’å®Œæˆï¼Œæˆæœ¬$0.03ï¼Œè´¨é‡ç¨³å®š
- **AIä¼˜åŒ–å±‚**ï¼š20%åœºæ™¯15ç§’ä¿®å¤ï¼Œæˆæœ¬$0.05ï¼Œä¿ç•™æ¨¡æ¿ä¼˜åŠ¿
- **AIé‡æ–°ç”Ÿæˆå±‚**ï¼š5%æç«¯åœºæ™¯60ç§’å…œåº•ï¼Œæˆæœ¬$0.20ï¼Œç¡®ä¿100%è¦†ç›–

### 2. ä¸ºä»€ä¹ˆé€‰æ‹©Qwen-MaxåšAIä¼˜åŒ–ï¼Œè€ŒéDeepSeek-R1ï¼Ÿ

**ç­”**ï¼šQwen-Maxåœ¨ä»£ç ç†è§£å’Œç²¾å‡†ä¿®å¤ä»»åŠ¡ä¸Šè¡¨ç°æ›´å¥½ï¼š
- **æ¨ç†èƒ½åŠ›**ï¼šQwen-Maxæ¨ç†èƒ½åŠ›å¼ºï¼Œèƒ½å‡†ç¡®ç†è§£éªŒè¯é”™è¯¯
- **ä¸­æ–‡æ”¯æŒ**ï¼šé”™è¯¯ä¿¡æ¯é€šå¸¸æ˜¯ä¸­æ–‡ï¼ŒQwen-Maxä¸­æ–‡ç†è§£æ›´å¥½
- **æˆæœ¬**ï¼šQwen-Maxæˆæœ¬ä½äºDeepSeek-R1ï¼ˆ$0.05 vs $0.20ï¼‰
- **é€Ÿåº¦**ï¼šQwen-Maxå“åº”é€Ÿåº¦å¿«ï¼ˆ15ç§’ vs 60ç§’ï¼‰

### 3. ä¸ºä»€ä¹ˆå¤ç”¨SaToken/Supabaseè€Œéè‡ªå·±å®ç°æƒé™ï¼Ÿ

**ç­”**ï¼šæˆç†Ÿæ–¹æ¡ˆç»è¿‡ç”Ÿäº§éªŒè¯ï¼Œç¨³å®šæ€§å’Œå®‰å…¨æ€§æ›´æœ‰ä¿éšœï¼š
- **çœæ—¶**ï¼šé¿å…é‡å¤é€ è½®å­ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´
- **ç¨³å®š**ï¼šæˆç†Ÿæ–¹æ¡ˆç»è¿‡å¤§é‡ç”Ÿäº§ç¯å¢ƒéªŒè¯
- **å®‰å…¨**ï¼šæƒé™ç³»ç»Ÿå®‰å…¨æ¼æ´ä»£ä»·é«˜ï¼Œä½¿ç”¨æˆç†Ÿæ–¹æ¡ˆæ›´å¯é 
- **ç»´æŠ¤**ï¼šç¬¬ä¸‰æ–¹æ–¹æ¡ˆæœ‰ä¸“ä¸šå›¢é˜Ÿç»´æŠ¤ï¼Œå‡è½»ç»´æŠ¤è´Ÿæ‹…

---

## ğŸ“– å‚è€ƒèµ„æ–™

### æŠ€æœ¯æ–‡æ¡£

- [Spring AI Alibabaå®˜æ–¹æ–‡æ¡£](https://spring-cloud-alibaba-group.github.io/spring-ai-alibaba/)
- [Qwen-Max APIæ–‡æ¡£](https://help.aliyun.com/zh/dashscope/)
- [SaTokenæƒé™æ¡†æ¶](https://sa-token.cc/)
- [Supabase RLSæ–‡æ¡£](https://supabase.com/docs/guides/auth/row-level-security)
- [MyBatis-Pluså®˜æ–¹æ–‡æ¡£](https://baomidou.com/)

### å­¦æœ¯è®ºæ–‡

- **Few-Shot Learning for Code Generation**: Brown et al. "Language Models are Few-Shot Learners" (GPT-3 Paper)
- **Code Repair with AI**: Chen et al. "Evaluating Large Language Models Trained on Code" (Codex Paper)
- **Template-based Code Generation**: Allamanis et al. "A Survey of Machine Learning for Big Code and Naturalness"

---

## ğŸ‰ æ€»ç»“

ç»ˆææ··åˆä»£ç ç”Ÿæˆæ–¹æ¡ˆé€šè¿‡**ä¸‰å±‚ç”Ÿæˆç­–ç•¥**å®ç°äº†ï¼š

âœ… **100%è¦†ç›–ç‡** - æ‰€æœ‰ä¸šåŠ¡åœºæ™¯éƒ½èƒ½ç”Ÿæˆ
âœ… **9ç§’å¹³å‡è€—æ—¶** - æ¯”çº¯AIå¿«80%
âœ… **$0.05å¹³å‡æˆæœ¬** - æ¯”çº¯AIçœ67%
âœ… **95åˆ†ä»£ç è´¨é‡** - ä¸‰ç¯éªŒè¯ä¿éšœ
âœ… **96.75%æˆåŠŸç‡** - ä¸‰å±‚å…œåº•æœºåˆ¶

**æ ¸å¿ƒåˆ›æ–°**ï¼šAIä¼˜åŒ–æ™ºèƒ½ä½“ï¼ˆSpring AI Alibaba Qwen-Maxï¼‰ç²¾å‡†ä¿®å¤æ¨¡æ¿ä»£ç ï¼Œä¿ç•™æ¨¡æ¿ä¼˜åŠ¿åŒæ—¶ç¡®ä¿è´¨é‡ã€‚

**ä¸‹ä¸€æ­¥**ï¼šå¯åŠ¨2å¤©MVPéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åè¿›å…¥4å‘¨å®Œæ•´å¼€å‘ã€‚

---

**Made with â¤ï¸ by Ingenio AI Team**
