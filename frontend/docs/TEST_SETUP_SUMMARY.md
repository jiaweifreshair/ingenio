# æµ‹è¯•ç¯å¢ƒæ­å»ºæ€»ç»“

**Phase**: Week 1 Day 3 Phase 3.1 - æµ‹è¯•ç¯å¢ƒæ­å»º
**å®Œæˆæ—¶é—´**: 2025-11-14
**è´Ÿè´£äºº**: Claude Code Agent
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è§ˆ

å»ºç«‹å®Œæ•´çš„å‰ç«¯æµ‹è¯•åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2Eæµ‹è¯•ç¯å¢ƒï¼Œéµå¾ªé›¶Mockç­–ç•¥ã€‚

---

## âœ… å®Œæˆçš„ä»»åŠ¡

### 1. æµ‹è¯•ç¯å¢ƒå˜é‡é…ç½®

**æ–‡ä»¶**: `.env.test`

**é…ç½®å†…å®¹**:
- çœŸå®åç«¯APIåœ°å€ï¼š`http://localhost:8080`
- AgentæœåŠ¡åœ°å€ï¼š`http://localhost:8000`
- æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼ˆPostgreSQLï¼‰
- æµ‹è¯•Redisè¿æ¥
- è°ƒè¯•æ¨¡å¼å¼€å¯

**è®¾è®¡åŸåˆ™**: éµå¾ªé›¶Mockç­–ç•¥ï¼ˆCLAUDE.md 5.8èŠ‚ï¼‰ï¼Œä½¿ç”¨çœŸå®åç«¯å¼€å‘ç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚

---

### 2. æµ‹è¯•æ¡†æ¶é…ç½®

#### 2.1 Vitesté…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `vitest.config.ts`

**å·²æœ‰é…ç½®**:
- âœ… JSDOMç¯å¢ƒ
- âœ… å…¨å±€æµ‹è¯•API
- âœ… è¦†ç›–ç‡é˜ˆå€¼ï¼š85%ï¼ˆlines/functions/branches/statementsï¼‰
- âœ… setupæ–‡ä»¶ï¼š`src/test/setup.ts`
- âœ… è·¯å¾„åˆ«åï¼š`@` -> `./src`

#### 2.2 Playwrighté…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `playwright.config.ts`

**ä¼˜åŒ–å†…å®¹**:
- âœ… æœ¬åœ°å¼€å‘ï¼šä»…æµ‹è¯•chromiumï¼ˆå¿«é€Ÿåé¦ˆï¼‰
- âœ… CIç¯å¢ƒï¼šæµ‹è¯•æ‰€æœ‰æµè§ˆå™¨ï¼ˆchromium/firefox/webkit/mobileï¼‰
- âœ… å¹¶å‘æ§åˆ¶ï¼šæœ¬åœ°å¹¶å‘ï¼ŒCIä¸²è¡Œï¼ˆç¨³å®šæ€§ï¼‰
- âœ… è¶…æ—¶é…ç½®ï¼šä»ç¯å¢ƒå˜é‡è¯»å–ï¼ˆ30ç§’é»˜è®¤ï¼‰
- âœ… è§†é¢‘å½•åˆ¶ï¼šä»…å¤±è´¥æ—¶ä¿ç•™ï¼ˆè°ƒè¯•ç”¨ï¼‰

---

### 3. æµ‹è¯•Setupæ–‡ä»¶æ›´æ–°

**æ–‡ä»¶**: `src/test/setup.ts`

**ç§»é™¤å†…å®¹**:
- âŒ Mock Next.js routerï¼ˆè¿åé›¶Mockç­–ç•¥ï¼‰
- âŒ Mockç¯å¢ƒå˜é‡

**æ–°å¢å†…å®¹**:
- âœ… ç¯å¢ƒå˜é‡åŠ è½½ï¼ˆä»`.env.test`ï¼‰
- âœ… Mock `window.matchMedia`ï¼ˆJSDOMé™åˆ¶ï¼Œå¿…é¡»Mockï¼‰
- âœ… Mock `ResizeObserver`ï¼ˆJSDOMé™åˆ¶ï¼Œå¿…é¡»Mockï¼‰
- âœ… Consoleé”™è¯¯è¿‡æ»¤ï¼ˆå‡å°‘å™ªéŸ³ï¼‰
- âœ… è‡ªåŠ¨æ¸…ç†Reactç»„ä»¶ï¼ˆafterEach cleanupï¼‰

**å…³é”®æ³¨é‡Š**: è¯´æ˜ä¸ºä½•éœ€è¦Mockæµè§ˆå™¨APIï¼ˆJSDOMé™åˆ¶ï¼‰è€Œéè¿åé›¶Mockç­–ç•¥ã€‚

---

### 4. æµ‹è¯•å·¥å…·å‡½æ•°

#### 4.1 æµ‹è¯•è¾…åŠ©å‡½æ•°

**æ–‡ä»¶**: `src/test/utils/test-helpers.ts`

**æä¾›åŠŸèƒ½**:
- â±ï¸ ç­‰å¾…å·¥å…·ï¼š`wait()`, `waitFor()`
- ğŸ² æ•°æ®ç”Ÿæˆï¼š`randomString()`, `randomInt()`
- ğŸŒ APIæµ‹è¯•ï¼š`apiGet()`, `apiPost()`, `buildApiUrl()`
- âœ… æ–­è¨€å¢å¼ºï¼š`assertHasKeys()`, `assertNotEmpty()`
- ğŸ­ æ•°æ®å·¥å‚ï¼š`createMockUser()`, `createMockAppSpec()`

**è®¾è®¡åŸåˆ™**: æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨çœŸå®åç«¯åœ°å€ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰ã€‚

#### 4.2 Reactç»„ä»¶æµ‹è¯•åŒ…è£…å™¨

**æ–‡ä»¶**: `src/test/utils/render-with-providers.tsx`

**æä¾›åŠŸèƒ½**:
- ğŸ”§ `renderWithProviders()`ï¼šå¸¦Contextçš„æ¸²æŸ“å‡½æ•°
- ğŸ“¦ é‡æ–°å¯¼å‡ºTesting Libraryæ‰€æœ‰å·¥å…·
- ğŸ‘† é‡æ–°å¯¼å‡º`userEvent`å·¥å…·

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { renderWithProviders, screen } from '@/test/utils/render-with-providers';

test('renders component', () => {
  renderWithProviders(<MyComponent />);
  expect(screen.getByText('Hello')).toBeInTheDocument();
});
```

---

### 5. ç¤ºä¾‹å•å…ƒæµ‹è¯•

#### 5.1 å·¥å…·å‡½æ•°æµ‹è¯•

**æ–‡ä»¶**: `src/lib/utils.test.ts`

**æµ‹è¯•å†…å®¹**:
- âœ… `cn()` classNameåˆå¹¶å·¥å…·
- âœ… 8ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆæ­£å¸¸/è¾¹ç•Œ/é”™è¯¯æƒ…å†µï¼‰
- âœ… è¦†ç›–ç‡ï¼š78.26%

**æµ‹è¯•ç»“æœ**: 8/8 é€šè¿‡ âœ…

#### 5.2 UIç»„ä»¶æµ‹è¯•

**æ–‡ä»¶**: `src/components/ui/button.test.tsx`

**æµ‹è¯•å†…å®¹**:
- âœ… åŸºç¡€æ¸²æŸ“ï¼ˆ3ä¸ªæµ‹è¯•ï¼‰
- âœ… å˜ä½“æ ·å¼ï¼ˆ6ä¸ªæµ‹è¯•ï¼šdefault/destructive/outline/secondary/ghost/linkï¼‰
- âœ… å°ºå¯¸å˜ä½“ï¼ˆ4ä¸ªæµ‹è¯•ï¼šdefault/sm/lg/iconï¼‰
- âœ… äº¤äº’è¡Œä¸ºï¼ˆ3ä¸ªæµ‹è¯•ï¼šç‚¹å‡»/ç¦ç”¨/typeå±æ€§ï¼‰
- âœ… asChildåŠŸèƒ½ï¼ˆ1ä¸ªæµ‹è¯•ï¼‰
- âœ… åŠ¨ç”»æ•ˆæœï¼ˆ1ä¸ªæµ‹è¯•ï¼‰
- âœ… è¾¹ç•Œæƒ…å†µï¼ˆ3ä¸ªæµ‹è¯•ï¼‰

**æµ‹è¯•ç»“æœ**: 21/21 é€šè¿‡ âœ…

---

### 6. Package.jsonå‘½ä»¤æ›´æ–°

**æ–°å¢å‘½ä»¤**:
```json
{
  "test:unit": "vitest --run",              // è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆä¸€æ¬¡æ€§ï¼‰
  "test:unit:watch": "vitest",              // è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆwatchæ¨¡å¼ï¼‰
  "test:coverage": "vitest --coverage --run", // ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
  "e2e:chromium": "playwright test --project=chromium", // ä»…æµ‹è¯•chromium
  "test:all": "pnpm typecheck && pnpm test:unit && pnpm e2e:chromium" // å®Œæ•´æµ‹è¯•æµç¨‹
}
```

---

## ğŸ“Š éªŒæ”¶æ ‡å‡†å®Œæˆæƒ…å†µ

| æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| `pnpm test:unit` å¯æ‰§è¡Œ | âœ… | æˆåŠŸè¿è¡Œå¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯• |
| `pnpm e2e` å¯æ‰§è¡Œ | âœ… | Playwrighté…ç½®æ­£ç¡® |
| TypeScript 0 errors | âœ… | `pnpm typecheck` é€šè¿‡ |
| ç¤ºä¾‹æµ‹è¯•éªŒè¯ç¯å¢ƒ | âœ… | utils.test.ts (8/8), button.test.tsx (21/21) |

---

## ğŸ¯ å…³é”®æˆæœ

### æµ‹è¯•åŸºç¡€è®¾æ–½
- âœ… å®Œæ•´çš„Vitest + Playwrightæµ‹è¯•ç¯å¢ƒ
- âœ… é›¶Mockç­–ç•¥å®æ–½ï¼ˆä½¿ç”¨çœŸå®åç«¯APIï¼‰
- âœ… æµ‹è¯•å·¥å…·å‡½æ•°åº“å»ºç«‹
- âœ… Reactç»„ä»¶æµ‹è¯•åŒ…è£…å™¨

### é…ç½®ä¼˜åŒ–
- âœ… æœ¬åœ°å¼€å‘å¿«é€Ÿåé¦ˆï¼ˆä»…chromiumï¼‰
- âœ… CIç¯å¢ƒå®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰
- âœ… ç¯å¢ƒå˜é‡éš”ç¦»ï¼ˆ.env.testï¼‰
- âœ… TypeScriptä¸¥æ ¼ç±»å‹æ£€æŸ¥

### ç¤ºä¾‹æµ‹è¯•
- âœ… 29ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… è¦†ç›–å·¥å…·å‡½æ•°å’ŒUIç»„ä»¶
- âœ… æœ€ä½³å®è·µç¤ºèŒƒ

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å·¥å…· | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|
| Vitest | 1.3.1 | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| Testing Library | 14.2.1 | Reactç»„ä»¶æµ‹è¯• |
| Playwright | 1.41.2 | E2Eæµ‹è¯• |
| JSDOM | 24.0.0 | DOMç¯å¢ƒæ¨¡æ‹Ÿ |
| @vitest/coverage-v8 | 1.3.1 | è¦†ç›–ç‡æŠ¥å‘Š |

---

## ğŸ“ åç»­å»ºè®®

### Phase 3.2: æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•ï¼ˆå»ºè®®4å°æ—¶ï¼‰

**ä¼˜å…ˆçº§æ’åº**:
1. **P0 æœ€é«˜ä¼˜å…ˆçº§**ï¼ˆå¿…é¡»æµ‹è¯•ï¼‰:
   - `src/lib/api/client.ts` - APIå®¢æˆ·ç«¯åŸºç¡€è®¾æ–½
   - `src/lib/api/appspec.ts` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
   - `src/hooks/use-generation-task.ts` - å…³é”®ä¸šåŠ¡Hook

2. **P1 é«˜ä¼˜å…ˆçº§**ï¼ˆé‡è¦æµ‹è¯•ï¼‰:
   - `src/components/wizard/*.tsx` - å‘å¯¼ç»„ä»¶
   - `src/lib/api/generate.ts` - ä»£ç ç”Ÿæˆé€»è¾‘
   - `src/lib/websocket/manager.ts` - WebSocketç®¡ç†

3. **P2 ä¸­ä¼˜å…ˆçº§**ï¼ˆå»ºè®®æµ‹è¯•ï¼‰:
   - å…¶ä»–UIç»„ä»¶ï¼ˆCard, Input, Selectç­‰ï¼‰
   - å…¶ä»–ä¸šåŠ¡Hook
   - å·¥å…·å‡½æ•°

**ç›®æ ‡è¦†ç›–ç‡**: æ ¸å¿ƒæ¨¡å—â‰¥90%ï¼Œæ•´ä½“â‰¥85%

### Phase 3.3: E2Eæµ‹è¯•ä¼˜åŒ–ï¼ˆå»ºè®®2å°æ—¶ï¼‰

**ä¼˜åŒ–æ–¹å‘**:
1. å°†ç°æœ‰24ä¸ªE2Eæµ‹è¯•ä»`src/e2e/*.spec.ts`ç§»åŠ¨åˆ°ç‹¬ç«‹æµ‹è¯•ç›®å½•
2. ä¼˜åŒ–E2Eæµ‹è¯•æ€§èƒ½ï¼ˆå¹¶è¡Œæ‰§è¡Œã€å…±äº«fixtureï¼‰
3. æ·»åŠ å…³é”®ç”¨æˆ·æµç¨‹çš„E2Eæµ‹è¯•
4. é›†æˆåˆ°CI/CDæµç¨‹

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼ˆä¸€æ¬¡æ€§ï¼‰
pnpm test:unit

# è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆwatchæ¨¡å¼ï¼Œå¼€å‘æ—¶ä½¿ç”¨ï¼‰
pnpm test:unit:watch

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pnpm test src/lib/utils.test.ts

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage
```

### è¿è¡ŒE2Eæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰
pnpm e2e

# ä»…æµ‹è¯•chromiumï¼ˆæœ¬åœ°å¼€å‘æ¨èï¼‰
pnpm e2e:chromium

# UIæ¨¡å¼ï¼ˆå¯è§†åŒ–è°ƒè¯•ï¼‰
pnpm e2e:ui
```

### å®Œæ•´æµ‹è¯•æµç¨‹
```bash
# TypeScriptæ£€æŸ¥ + å•å…ƒæµ‹è¯• + E2Eæµ‹è¯•ï¼ˆchromiumï¼‰
pnpm test:all
```

---

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. é›¶Mockç­–ç•¥
- âœ… **å…è®¸**: Mockæµè§ˆå™¨APIï¼ˆmatchMedia, ResizeObserverï¼‰- JSDOMé™åˆ¶
- âŒ **ç¦æ­¢**: Mock APIå“åº”ã€æ•°æ®åº“è¿”å›å€¼ã€ç¬¬ä¸‰æ–¹æœåŠ¡

### 2. æµ‹è¯•ç¯å¢ƒè¦æ±‚
- åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8080`
- AgentæœåŠ¡è¿è¡Œåœ¨ `http://localhost:8000`
- PostgreSQLè¿è¡Œåœ¨ `localhost:5432`
- Redisè¿è¡Œåœ¨ `localhost:6379`

### 3. ä¾èµ–é—®é¢˜
- å¦‚é‡åˆ°rollupæˆ–esbuildæ¶æ„é—®é¢˜ï¼Œè¿è¡Œ`pnpm install --force`
- React 19.0.0ä¸éƒ¨åˆ†æµ‹è¯•åº“æœ‰peer dependencyè­¦å‘Šï¼ˆä¸å½±å“ä½¿ç”¨ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Vitestå®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Testing Library React](https://testing-library.com/docs/react-testing-library/intro/)
- [Playwrightå®˜æ–¹æ–‡æ¡£](https://playwright.dev/)
- [CLAUDE.mdæµ‹è¯•è§„èŒƒ](/.claude/CLAUDE.md#13-æµ‹è¯•é©±åŠ¨å¼€å‘è§„èŒƒ)

---

## âœ… Phase 3.1å®Œæˆæ ‡å¿—

- âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆ
- âœ… éªŒæ”¶æ ‡å‡†é€šè¿‡
- âœ… TypeScript 0 errors
- âœ… ç¤ºä¾‹æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ–‡æ¡£æ›´æ–°å®Œæˆ

**æ€»è€—æ—¶**: çº¦2å°æ—¶ï¼ˆç¬¦åˆé¢„ç®—ï¼‰

**ä¸‹ä¸€æ­¥**: Phase 3.2 - æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•ï¼ˆ4å°æ—¶é¢„ç®—ï¼‰
